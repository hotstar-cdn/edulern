<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz</title>
  <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet"/>
  <style>
    body { font-family: 'Arial'; margin: 0; background: #f6f8fc; }
    .swiper { width: 100%; height: 100vh; }
    .swiper-slide { padding: 20px; box-sizing: border-box; background: #fff; border-radius: 16px; margin: 10px; }
    .option { margin: 10px 0; padding: 10px; background: #eee; border-radius: 8px; cursor: pointer; }
    .option.selected { background: #bde0fe; }
    img { max-width: 100%; height: auto; }
    #submitBtn { margin: 20px; padding: 12px 20px; background: #007bff; color: white; border: none; border-radius: 10px; }
  </style>
</head>
<body>
  <div class="swiper">
    <div class="swiper-wrapper" id="quizSlides"></div>
  </div>
  <center><button id="submitBtn">Submit</button></center>

  <script src="data.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const limit = parseInt(urlParams.get('n')) || 10;
    const data = quizzes[code]?.questions?.slice(0, limit) || [];

    const container = document.getElementById("quizSlides");
    const answers = [];

    data.forEach((q, i) => {
      const slide = document.createElement("div");
      slide.className = "swiper-slide";
      slide.innerHTML = `
        <h3>Q${i + 1}: ${q.difficulty.toUpperCase()}</h3>
        ${q.type === "image" ? `<img src="${q.questionImage}" />` : `<p>${q.question}</p>`}
        <div id="opts-${i}"></div>
      `;
      container.appendChild(slide);

      const optsDiv = slide.querySelector(`#opts-${i}`);
      q.options.forEach((opt, idx) => {
        const div = document.createElement("div");
        div.className = "option";
        div.innerHTML = q.type === "image" ? `<img src="${opt}" />` : opt;
        div.onclick = () => {
          document.querySelectorAll(`#opts-${i} .option`).forEach(o => o.classList.remove("selected"));
          div.classList.add("selected");
          answers[i] = idx;
        };
        optsDiv.appendChild(div);
      });
    });

    new Swiper('.swiper', {
      direction: 'horizontal',
      loop: false
    });

    document.getElementById("submitBtn").onclick = () => {
      let correct = 0;
      data.forEach((q, i) => { if (answers[i] === q.correct) correct++; });
      const time = Math.floor(Math.random() * 10) + 1;
      localStorage.setItem("result", JSON.stringify({ code, correct, total: data.length, time }));
      localStorage.setItem("answers", JSON.stringify(answers));
      window.location.href = `2.html?code=${code}`;
    };
  </script>
</body>
</html>

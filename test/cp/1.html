<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="data.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 370px; margin: auto; background: #f4f4f4; padding: 0; }
    .slide { display: none; padding: 20px; animation: fadeIn 0.3s ease-in; }
    .slide.active { display: block; }
    .question-img, .option-img { max-width: 100%; margin: 10px auto; border-radius: 8px; }
    .option { border: 2px solid #ccc; padding: 10px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; background: #fff; }
    .option.selected { background: #cce5ff; border-color: #3399ff; }
    button { width: 100%; padding: 12px; font-size: 16px; border: none; background: #007bff; color: white; border-radius: 8px; margin-top: 20px; }
    @keyframes fadeIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
  </style>
</head>
<body>
  <div id="quizContainer"></div>
  <script>
    const code = new URLSearchParams(location.search).get("code"), test = allTests[code];
    const container = document.getElementById("quizContainer");
    let currentIndex = 0, userAnswers = [];

    if (!test) {
      container.innerHTML = "<h2>Invalid Code</h2>";
    } else {
      test.questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "slide" + (i === 0 ? " active" : "");
        div.innerHTML = `<h3>Q${i + 1}: ${q.question}</h3>${q.questionImage ? `<img src="${q.questionImage}" class="question-img">` : ""}
          ${q.options.map((opt, j) => `
            <div class="option" onclick="selectOption(${i}, ${j}, this)">
              ${opt.image ? `<img src="${opt.image}" class="option-img">` : ""}
              ${opt.text ? `<p>${opt.text}</p>` : ""}
            </div>`).join('')}
        `;
        container.appendChild(div);
      });

      const submitBtn = document.createElement("button");
      submitBtn.textContent = "Submit";
      submitBtn.onclick = () => {
        localStorage.setItem("quiz_" + code + "_ans", JSON.stringify(userAnswers));
        location.href = `2.html?code=${code}`;
      };
      container.appendChild(submitBtn);
    }

    function selectOption(qIdx, optIdx, el) {
      userAnswers[qIdx] = optIdx;
      document.querySelectorAll(`.slide:nth-child(${qIdx + 1}) .option`).forEach(o => o.classList.remove("selected"));
      el.classList.add("selected");
      setTimeout(() => nextSlide(), 300);
    }

    function nextSlide() {
      const slides = document.querySelectorAll(".slide");
      if (currentIndex < slides.length - 1) {
        slides[currentIndex].classList.remove("active");
        currentIndex++;
        slides[currentIndex].classList.add("active");
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Student Page</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    #countdown { font-size: 24px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Waiting for Class...</h2>
  <div id="countdown">Checking class status...</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAX27di1k3zuHMdFVtuzFjqAnXKb-Juo7Y",
      authDomain: "community-edulearn.firebaseapp.com",
      projectId: "community-edulearn",
      storageBucket: "community-edulearn.firebasestorage.app",
      messagingSenderId: "517780625337",
      appId: "1:517780625337:web:b4d491cfe8057aa0dd4868",
      measurementId: "G-7T47TFT2ZX"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function redirectTo(link) {
      window.location.href = link;
    }

    db.collection("classes").doc("latest").get().then((doc) => {
      if (!doc.exists) {
        redirectTo("https://abc.xyz/2");
        return;
      }

      const data = doc.data();
      const classTime = new Date(data.time).getTime();

      function checkClassTime() {
        const now = Date.now();
        const diff = classTime - now;

        if (data.status === "instant" || diff <= 0) {
          redirectTo("https://hotstar-cdn.github.io/edulern/class/");
        } else {
          const minutes = Math.floor(diff / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);
          document.getElementById("countdown").innerText =
            `Class starts in ${minutes}m ${seconds}s`;
        }
      }

      checkClassTime();
      setInterval(checkClassTime, 1000);
    }).catch((error) => {
      console.error("Error fetching class data:", error);
      redirectTo("https://abc.xyz/2");
    });
  </script>
</body>
</html>
